<app-page-title title="Add / Edit a user"></app-page-title>

<div class="container-fluid">
    @if (userTypes().length) {
    <form (ngSubmit)="onSubmit()" [formGroup]="form">
        <input class="form-control" type="text" placeholder="Last Name" formControlName="lastName" />
        @if (lastName.invalid && (lastName.dirty || lastName.touched)) {
        <div class="error-message bg-danger-subtle text-danger-emphasis">
            @if (lastName.hasError('required') || lastName.hasError('isBlank')) {
            Last name is required.
            }
            @if (lastName.hasError('maxlength')) {
            Last name cannot exceed 64 characters.
            }
        </div>
        }

        <input class="form-control" type="text" placeholder="First Name" formControlName="firstName" />
        @if (firstName.invalid && (firstName.dirty || firstName.touched)) {
        <div class="error-message bg-danger-subtle text-danger-emphasis">
            @if (firstName.hasError('required') || firstName.hasError('isBlank')) {
            First name is required.
            }
            @if (firstName.hasError('maxlength')) {
            First name cannot exceed 64 characters.
            }
        </div>
        }

        <input class="form-control" type="text" placeholder="Email" formControlName="email" />
        @if (email.invalid && (email.dirty || email.touched)) {
        <div class="error-message bg-danger-subtle text-danger-emphasis">
            @if (email.hasError('pattern')) {
            Email must follow the pattern: [name]@[provider].[domain]
            }
        </div>
        }

        <select class="form-select" formControlName="userType">
            @for (userType of userTypes(); track userType.id) {
            <option [value]="userType.name">{{ userType.name }}</option>
            }
        </select>
        @if (userType.invalid && (userType.dirty || userType.touched)) {
        <div class="error-message bg-danger-subtle text-danger-emphasis">
            @if (userType.hasError('required')) {
            User type is required.
            }
        </div>
        }

        <button bigButton type="submit">{{ editMode() ? 'Update' : 'Create'}}</button>

        @if (errorMessage().length) {
        <div class="error-message bg-danger-subtle text-danger-emphasis">
            {{ errorMessage() }}
        </div>
        }
    </form>
    } @else {
    <div class="msg-container alert alert-warning my-4">
        <p>You cannot add a new user without a type...</p>
        Start by adding some user types!
    </div>
    <a bigButton [routerLink]="['/', 'user_types', 'add']">Add a user type</a>
    }
</div>